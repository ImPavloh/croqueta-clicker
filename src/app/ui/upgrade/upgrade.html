<div
  class="upgrade-wrapper"
  [class.expanded]="expanded"
  [class.locked]="!unlocked"
  [class.bought]="bought"
>
  <!-- Preview colapsado (siempre visible) -->
  <div class="upgrade-preview" (click)="toggleExpand()">
    <div class="preview-content">
      <!-- Imagen pequeña -->
      <img class="preview-image" src="{{ config.image }}" alt="{{ config.name | transloco }}" />

      <!-- Info mínima -->
      <div class="preview-info">
        <p class="preview-name" [class.text-gray-500]="!unlocked">
          @if (!unlocked) {
          <span>{{ 'upgrades.level' | transloco }} {{ config.level }}</span>
          } @else {
          {{ config.name | transloco }}
          }
        </p>
        @if (unlocked && !bought) {
        <p
          class="preview-price"
          [class.can-afford]="pointsService.points().gte(config.price)"
          [class.cannot-afford]="pointsService.points().lt(config.price)"
        >
          {{ config.price | short }} ¢
        </p>
        } @else if (bought) {
        <p class="preview-owned">{{ 'upgrades.bought' | transloco }}</p>
        }
      </div>

      <!-- Indicador de expansión -->
      <div class="expand-icon" [class.rotated]="expanded">
        <span>▼</span>
      </div>
    </div>
  </div>

  <!-- Contenido expandido -->
  @if (expanded) {
  <div class="upgrade-expanded">
    <div class="expanded-content">
      <!-- Estadísticas -->
      <div class="expanded-stats">
        <div class="stat-item">
          <span class="stat-label">{{ 'upgrades.bonus' | transloco }}:</span>
          <span class="stat-value text-green-700">+{{ config.clicks | short }} ¢/click</span>
        </div>

        <div class="stat-item">
          <span class="stat-label">{{ 'upgrades.exp' | transloco }}:</span>
          <span class="stat-value">+{{ config.exp | short }} XP</span>
        </div>

        <div class="stat-item">
          <span class="stat-label">{{ 'upgrades.requiredLevel' | transloco }}:</span>
          <span class="stat-value">{{ config.level }}</span>
        </div>

        @if (!bought) {
        <div class="stat-item">
          <span class="stat-label">{{ 'upgrades.price' | transloco }}:</span>
          <span
            class="stat-value"
            [class.text-green-700]="pointsService.points().gte(config.price)"
            [class.text-red-600]="pointsService.points().lt(config.price)"
          >
            {{ config.price | short }} ¢
          </span>
        </div>
        }
      </div>

      <!-- Botón de compra -->
      @if (!bought && unlocked) {
      <app-button
        type="button"
        variant="tertiary"
        (click)="buyUpgrade(); $event.stopPropagation()"
        [disabled]="pointsService.points().lt(config.price)"
        [hoverable]="pointsService.points().gte(config.price)"
        [clickable]="pointsService.points().gte(config.price)"
        [class.full-width]="true"
        class="buy-button"
        [noSound]="true"
      >
        {{ 'upgrades.buy' | transloco }}
      </app-button>
      }
    </div>
  </div>
  }
</div>
